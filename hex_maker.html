<!DOCTYPE html>
<html lang="ja">
<head>
    <!-- <script async src="https://www.googletagmanager.com/gtag/js?id=G-T4SJ8S23EC"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-T4SJ8S23EC');
    </script> -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ヘクサ作成ツール｜違法建築のTRPG便利ツール</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: #f7f8fa;
            margin: auto;
            padding: 20px;
            width: 900px;
            color: #333;
        }

        h1 {
            font-size: 28px;
            border-bottom: 2px solid #ccc;
            padding-bottom: 5px;
            margin-bottom: 20px;
            margin-top: 10px;
        }

        .section {
            background: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        div {
            display: block;
            margin-bottom: 15px;
        }

        label {
            font-weight: bold;
            margin-right: 10px;
        }

        input[type="text"], input[type="number"], select {
            box-sizing: border-box;
            font-size: 18px;
            padding: 0px 5px 0px 5px;
            height: 30px;
        }

        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
            -moz-appearance:textfield;
        }

        input[type="number"] {
            border: 1px solid #888;
            border-radius: 4px;
            box-sizing: border-box;
            width: 60px;
            height: 30px;
            font-size: 18px;
            padding: 0px 5px 0px 5px;
            vertical-align: middle;
        }
        input[type="color"] {
            height: 35px;
            border: 1px solid #aaa;
            border-radius: 4px;
            vertical-align: middle;
        }
        input[type="range"] {
            vertical-align: middle;
            width: 150px;
        }
        input[type="checkbox"] {
            vertical-align: middle;
            width: 20px;
            height: 20px;
            margin-right: 5px;
        }

        canvas {
            border: 1px solid #333;
            margin-top: 20px;
            display: block;
            margin-left: auto;
            margin-right: auto;
            max-width: 100%;
            height: auto;
        }

        button {
            background-color: #448AD4;
            color: white;
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color .2s;
            font-weight: bold;
            margin-right: 10px;
            margin-top: 10px;
        }

        button:hover {
            background-color: #3D7BCD;
        }

        #opacityValue {
            margin-left: 5px;
            font-weight: normal;
            display: inline-block;
            min-width: 2em;
            text-align: right;
        }

        #coordinateSettings {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px dashed #888;
        }
        #coordinateSettings label {
            margin-right: 20px;
        }
    </style>
</head>
<body><div style="position: relative;">
        <h1 style="margin: 0;">ヘックス作成ツール</h1>
        <a href="https://ihoukentiku.github.io" target="_blank" style="position: absolute; bottom: 10px; right: 0;">
            <button style="padding: 6px 12px;">ホームページへ</button>
        </a>
    </div>

    <div class="section">
        <div>
            <label>グリッドの色 <input type="color" id="gridColor" value="#000000"></label>
            <label>グリッドの太さ <input type="number" id="lineWidth" value="2" min="1"> px</label>
            <label>
                グリッドの透明度
                <input type="range" id="lineOpacity" value="1.0" min="0.0" max="1.0" step="0.01" oninput="updateOpacityValue(this.value)">
                <span id="opacityValue">1.0</span>
            </label>
        </div>
        <div>
            <label>サイズ <input type="number" id="cellSize" value="90" min="1"> px</label>
            <label>横の六角形数 <input type="number" id="cols" value="10" min="1"></label>
            <label>縦の六角形数 <input type="number" id="rows" value="10" min="1"></label>
            <label>グリッドに合わせる<input type="checkbox" id="fitGridCheck" checked></label>
            <label>1列目をずらす<input type="checkbox" id="shiftCheck"></label>
        </div>

        <div id="coordinateSettings">
            <label>
                座標を表示
                <input type="checkbox" id="showCoordinates">
            </label>
            <label>座標の色 <input type="color" id="coordColor" value="#000000"></label>
            <label>座標の文字サイズ(px) <input type="number" id="coordFontSize" value="18" min="1"></label>
        </div>

        <div style="margin:0">
            <button onclick="generateGrid()">生成</button>
            <button onclick="downloadGrid()">ダウンロード</button>
        </div>
    </div>

    <canvas id="gridCanvas"></canvas>

    <script>
        // 透明度表示を更新する関数
        function updateOpacityValue(value) {
            document.getElementById('opacityValue').textContent = value;
        }

        // 16進数カラーコードと透明度からRGBA文字列を生成する関数
        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        // グリッドを生成する関数
        function generateGrid() {
            // 入力値を取得
            const color = document.getElementById('gridColor').value;
            const lineWidth = parseInt(document.getElementById('lineWidth').value);
            const lineOpacity = parseFloat(document.getElementById('lineOpacity').value);
            const cellSize = parseInt(document.getElementById('cellSize').value); // 六角形の高さの基準サイズ
            const cols = parseInt(document.getElementById('cols').value);
            const rows = parseInt(document.getElementById('rows').value);
            const showCoordinates = document.getElementById('showCoordinates').checked;
            const coordColor = document.getElementById('coordColor').value;
            const coordFontSize = parseInt(document.getElementById('coordFontSize').value);
            const fitGridCheck = document.getElementById('fitGridCheck').checked;
            const shiftCheck = document.getElementById('shiftCheck').checked;

            const canvas = document.getElementById('gridCanvas');
            const ctx = canvas.getContext('2d');

            const cellSizeX = fitGridCheck ? cellSize : cellSize/2*Math.sqrt(3);
            const offsetLeft = fitGridCheck ? 1/6 : 1/3;

            canvas.width = fitGridCheck ? cellSizeX * (cols) : cellSizeX * (cols + 1/3);
            canvas.height = cellSize * (rows + 1) / 2;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            ctx.strokeStyle = hexToRgba(color, lineOpacity);
            ctx.lineWidth = lineWidth;

            // 六角形を描画
            for (let r = 0; r < ( rows / 2 ); r++) {
                for (let c = 0; c < cols; c++) {
                    const shiftHex = shiftCheck ? (1-c % 2) : (c % 2);
                    const cx = (c + offsetLeft) * cellSizeX;
                    const cy = r * cellSize + shiftHex * (cellSize / 2);
                    // 六角形の頂点座標 (左上からの相対座標)
                    const vertices = [
                        { x: cx,                y: cy              }, // 左上
                        { x: cx - cellSizeX*1/3, y: cy + cellSize/2 }, // 左端
                        { x: cx,                y: cy + cellSize   }, // 左下
                        { x: cx + cellSizeX*2/3, y: cy + cellSize   }, // 右下
                        { x: cx + cellSizeX,     y: cy + cellSize/2 }, // 右端
                        { x: cx + cellSizeX*2/3, y: cy              }  // 右上
                    ];

                    // パスを描画
                    ctx.beginPath();
                    ctx.moveTo(vertices[0].x, vertices[0].y);
                    for (let i = 1; i < vertices.length; i++) {
                        ctx.lineTo(vertices[i].x, vertices[i].y);
                    }
                    ctx.closePath(); // パスを閉じる
                    ctx.stroke(); // 線を描画

                    // 座標を表示
                    if (showCoordinates) {
                        ctx.fillStyle = coordColor;
                        ctx.font = `${coordFontSize}px 'Arial'`;
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        // 座標テキストは "(行, 列)" 形式で表示
                        const coordinateText = `${c}-${r*2+shiftHex}`;
                        ctx.fillText(coordinateText, cx + cellSizeX*1/3, cy + cellSize/2);
                    }
                }
            }
        }

        // グリッドを画像としてダウンロードする関数
        function downloadGrid() {
            const canvas = document.getElementById('gridCanvas');
            const cellSize = parseInt(document.getElementById('cellSize').value); // 六角形の高さの基準サイズ
            const fitGridCheck = document.getElementById('fitGridCheck').checked;
            const link = document.createElement('a');
            const c = canvas.width/cellSize*2;
            const r = canvas.height/cellSize*2;
            link.download = fitGridCheck ? `hex_${c}x${r}.png` : `hex.png` ;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        // ページロード時に一度グリッドを生成
        window.onload = generateGrid;

    </script>
</body>
</html>